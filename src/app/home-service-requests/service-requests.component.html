<div class="service-requests">
    <div class="sidebar">
        <div class="logo">
          <img src="https://trial.chainsys.com/appplatform/images/chainsys-platform-logo.png" alt="ChainSys Logo">
        </div>
        <div class="menu">
          <h2></h2>

          <button (click)="home()">
            <i class="fas fa-home"></i> Home
          </button>
          
          <button (click)="showMyDetails()">
            <i class="fas fa-user"></i> My Details
          </button>
          
      <!-- Button for Leave Menu -->
      <button (click)="toggleLeaveMenu()">
        <i class="fas fa-clipboard-list"></i> Leave
        <i [class]="isLeaveMenuOpen ? 'fas fa-chevron-up' : 'fas fa-chevron-down'"></i>
      </button>
      
      <!-- Submenu for Leave Details and Leave Report -->
      <div *ngIf="isLeaveMenuOpen" class="submenu">
        <button (click)="showLeaveDetails()">
          <i class="fas fa-info-circle"></i> Leave Details
        </button>
        <button (click)="showLeaveSummary()">
          <i class="fas fa-chart-bar"></i> Leave Report
        </button>
      </div>
          <button class="active" (click)="showServiceRequests()">
            <i class="fas fa-tools"></i> Service Requests
          </button>

          <button (click)="showDekstopSupport()">
            <i class="fas fa-desktop"></i> Desktop Support
          </button>
          
          <button (click)="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
              
        </div>
      </div>
      <div class="main-content">
        <div class="header">
          <h2>Welcome! {{ employee?.employeename }}</h2>
        </div>
      
        <div class="filter-options">
          <h3>Filter Service Requests</h3>
          
          <!-- Button to toggle filter visibility -->
          <button class="toggle-button" (click)="toggleFilters()">
            {{ filtersVisible ? 'Hide Filters' : 'Show Filters' }}
          </button>
        
          <!-- Filter options container -->
          <div *ngIf="filtersVisible" class="filter-container">
            
            <div class="filter-inputs"> 
              <div class="date-range">
                <label for="dateFrom">From:</label>
                <input type="date" id="dateFrom" [(ngModel)]="filter.dateFrom" />
              </div>
        
              <div class="date-range">
                <label for="dateTo">To:</label>
                <input type="date" id="dateTo" [(ngModel)]="filter.dateTo" />
              </div>
        
              <button (click)="applyDateFilter()">Apply Date Filter</button>
            </div>
        
            <div class="filter-inputs"> 
              <div class="month-range">
                <label for="monthFrom">Month From:</label>
                <input type="month" id="monthFrom" [(ngModel)]="filter.monthFrom" />
              </div>
        
              <div class="month-range">
                <label for="monthTo">Month To:</label>
                <input type="month" id="monthTo" [(ngModel)]="filter.monthTo" />
              </div>
        
              <button (click)="applyMonthFilter()">Apply Month Filter</button>
            </div>
              <button (click)="resetFilters()">Reset Filters</button>
          </div>
        </div>
        
        <h2>Service Requests</h2>
        <ul>
          <li *ngFor="let id of filteredServiceRequestIds">
            <span (click)="toggleServiceRequestDetails(id)" style="cursor: pointer;">
              Service Request ID: {{ id }}
              <i [class]="expandedServiceRequestId === id ? 'fas fa-chevron-up' : 'fas fa-chevron-down'"></i>
            </span>
        
            <!-- Always show the date -->
            <p>
              <strong>Date:</strong> {{ getFormattedDate(serviceRequestDetails[id]?.date) }}
            </p>
          
            <div *ngIf="expandedServiceRequestId === id">
              <p><strong>Title:</strong> {{ serviceRequestDetails[id]?.title }}</p>
              <p><strong>Client:</strong> {{ serviceRequestDetails[id]?.client }}</p>
              <p><strong>Instance Name:</strong> {{ serviceRequestDetails[id]?.instanceName }}</p>
              <p><strong>Product/Team:</strong> {{ serviceRequestDetails[id]?.productTeam }}</p>
              <p><strong>Component:</strong> {{ serviceRequestDetails[id]?.component }}</p>
          
              <!-- Additional details are displayed only when expanded -->
              <ng-container *ngIf="serviceRequestDetails[id]?.subtype === 'Bug'; else changeRequestOrSupportDetails">
                <p><strong>Severity:</strong> {{ serviceRequestDetails[id]?.severity }}</p>
                <p><strong>Priority:</strong> {{ serviceRequestDetails[id]?.priority }}</p>
                <p><strong>Phase:</strong> {{ serviceRequestDetails[id]?.phase }}</p>
                <p><strong>Found In:</strong> {{ serviceRequestDetails[id]?.foundIn }}</p>
                <p><strong>Identified By AppBots:</strong> {{ serviceRequestDetails[id]?.Identified_By_appBots }}</p>
                <p><strong>Test Environment:</strong> {{ serviceRequestDetails[id]?.test_Environment }}</p>
                <p><strong>Assigned To:</strong> {{ serviceRequestDetails[id]?.assigned_To }}</p>
                <p><strong>Planned Release Version:</strong> {{ serviceRequestDetails[id]?.planned_Release_Version }}</p>
                <p><strong>Detailed Description:</strong> {{ serviceRequestDetails[id]?.detailed_Description }}</p>
                <p><strong>Steps to Reproduce:</strong> {{ serviceRequestDetails[id]?.steps_To_Reproduce }}</p>
                <p><strong>Expected Result:</strong> {{ serviceRequestDetails[id]?.expected_Result }}</p>
                <p><strong>Actual Result:</strong> {{ serviceRequestDetails[id]?.actual_Result }}</p>
              </ng-container>
          
              <ng-template #changeRequestOrSupportDetails>
                <ng-container *ngIf="serviceRequestDetails[id]?.subtype === 'Change Request'; else supportRequestDetails">
                  <p><strong>Severity:</strong> {{ serviceRequestDetails[id]?.severity }}</p>
                  <p><strong>Priority:</strong> {{ serviceRequestDetails[id]?.priority }}</p>
                  <p><strong>Identified By AppBots:</strong> {{ serviceRequestDetails[id]?.identifiedBy || 'N/A' }}</p>
                  <p><strong>Test Environment:</strong> {{ serviceRequestDetails[id]?.testEnvironment || 'N/A' }}</p>
                  <p><strong>Assigned To:</strong> {{ serviceRequestDetails[id]?.assignedTo || 'N/A' }}</p>
                  <p><strong>Planned Release Version:</strong> {{ serviceRequestDetails[id]?.plannedReleaseVersion || 'N/A' }}</p>
                  <p><strong>Detailed Description:</strong> {{ serviceRequestDetails[id]?.detailedDescription || 'N/A' }}</p>
                </ng-container>
          
                <ng-template #supportRequestDetails>
                  <p><strong>Priority:</strong> {{ serviceRequestDetails[id]?.priority }}</p>
                  <p><strong>Instance Name:</strong> {{ serviceRequestDetails[id]?.instanceName || 'N/A' }}</p>
                  <p><strong>Component:</strong> {{ serviceRequestDetails[id]?.component || 'N/A' }}</p>
                  <p><strong>Priority:</strong> {{ serviceRequestDetails[id]?.priority || 'N/A' }}</p>
                  <p><strong>Assigned To:</strong> {{ serviceRequestDetails[id]?.assignedTo || 'N/A' }}</p>
                  <p><strong>Detailed Description:</strong> {{ serviceRequestDetails[id]?.detailedDescription || 'N/A' }}</p>
                </ng-template>
              </ng-template>
            </div>
          </li>
          
          
        </ul>
        <!-- Display the no documents message if it exists -->
  <div *ngIf="noDocumentsMessage" class="no-docs-message">
    {{ noDocumentsMessage }}
  </div>
        <app-chatbot></app-chatbot>
      </div>
      
  